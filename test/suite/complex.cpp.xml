<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.sdml.info/srcML/src" xmlns:cpp="http://www.sdml.info/srcML/cpp" xmlns:diff="http://www.sdml.info/srcDiff" language="C++" dir="complex">

<unit filename="complex|complex">
<diff:delete><if>if <condition>(<expr><call><name><name>shape</name><operator>-&gt;</operator><name>hasAdditionalAttribute</name></name><argument_list>(<argument><expr><literal type="string">"text:anchor-type"</literal></expr></argument>)</argument_list></call></expr>)</condition><then> <block>{
    <diff:common><decl_stmt><decl><type><name>QString</name></type> <name>anchorType</name><diff:delete> <init>= <expr><call><name><name>shape</name><operator>-&gt;</operator><name>additionalAttribute</name></name><argument_list>(<argument><expr><literal type="string">"text:anchor-type"</literal></expr></argument>)</argument_list></call></expr></init></diff:delete></decl>;</decl_stmt>
</diff:common><diff:insert><if>if <condition>(<expr><call><name><name>shape</name><operator>-&gt;</operator><name>hasAdditionalAttribute</name></name><argument_list>(<argument><expr><literal type="string">"text:anchor-type"</literal></expr></argument>)</argument_list></call></expr>)</condition><then>
    <block type="pseudo"><expr_stmt><expr><name>anchorType</name> <operator>=</operator> <call><name><name>shape</name><operator>-&gt;</operator><name>additionalAttribute</name></name><argument_list>(<argument><expr><literal type="string">"text:anchor-type"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt></block></then>
<elseif>else <if>if <condition>(<expr><call><name><name>element</name><operator>.</operator><name>hasAttributeNS</name></name><argument_list>(<argument><expr><name><name>KoXmlNS</name><operator>::</operator><name>text</name></name></expr></argument>, <argument><expr><literal type="string">"anchor-type"</literal></expr></argument>)</argument_list></call></expr>)</condition><then>
    <block type="pseudo"><expr_stmt><expr><name>anchorType</name> <operator>=</operator> <call><name><name>element</name><operator>.</operator><name>attributeNS</name></name><argument_list>(<argument><expr><name><name>KoXmlNS</name><operator>::</operator><name>text</name></name></expr></argument>, <argument><expr><literal type="string">"anchor-type"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt></block></then></if></elseif>
<else>else
    <block type="pseudo"><expr_stmt><expr><name>anchorType</name> <operator>=</operator> <literal type="string">"as-char"</literal></expr>;</expr_stmt></block></else></if> <comment type="line">// default value</comment>

</diff:insert>    <diff:common><comment type="line">// page anchored shapes are handled differently</comment>
<diff:delete type="whitespace">    </diff:delete><if>if <condition>(<expr><name>anchorType</name> <operator>!=</operator> <literal type="string">"page"</literal></expr>)</condition><then> <block>{
    <diff:delete type="whitespace">    </diff:delete><decl_stmt><decl><type><name>KoTextAnchor</name> <modifier>*</modifier></type><name>anchor</name> <init>= <expr><operator>new</operator> <call><name>KoTextAnchor</name><argument_list>(<argument><expr><name>shape</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <diff:delete type="whitespace">    </diff:delete><expr_stmt><expr><call><name><name>anchor</name><operator>-&gt;</operator><name>loadOdfFromShape</name></name><argument_list>(<argument><expr><name>element</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
    <diff:delete type="whitespace">    </diff:delete><expr_stmt><expr><call><name><name>d</name><operator>-&gt;</operator><name>textSharedData</name><operator>-&gt;</operator><name>shapeInserted</name></name><argument_list>(<argument><expr><name>shape</name></expr></argument>, <argument><expr><name>element</name></expr></argument>, <argument><expr><name><name>d</name><operator>-&gt;</operator><name>context</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <diff:delete type="whitespace">    </diff:delete><decl_stmt><decl><type><name>KoTextDocumentLayout</name> <modifier>*</modifier></type><name>layout</name> <init>= <expr><call><name><name>qobject_cast</name><argument_list type="template">&lt;<argument><expr><name>KoTextDocumentLayout</name><operator>*</operator></expr></argument>&gt;</argument_list></name><argument_list>(<argument><expr><call><name><name>cursor</name><operator>.</operator><name>block</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>document</name><argument_list>()</argument_list></call><operator>-&gt;</operator><call><name>documentLayout</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <diff:delete type="whitespace">    </diff:delete><if>if <condition>(<expr><name>layout</name></expr>)</condition><then> <block>{
        <diff:delete type="whitespace">    </diff:delete><decl_stmt><decl><type><name>KoInlineTextObjectManager</name> <modifier>*</modifier></type><name>textObjectManager</name> <init>= <expr><call><name><name>layout</name><operator>-&gt;</operator><name>inlineTextObjectManager</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
        <diff:delete type="whitespace">    </diff:delete><if>if <condition>(<expr><name>textObjectManager</name></expr>)</condition><then> <block>{
            <diff:delete type="whitespace">    </diff:delete><expr_stmt><expr><call><name><name>textObjectManager</name><operator>-&gt;</operator><name>insertInlineObject</name></name><argument_list>(<argument><expr><name>cursor</name></expr></argument>, <argument><expr><name>anchor</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <diff:delete type="whitespace">    </diff:delete>}</block></then></if>
    <diff:delete type="whitespace">    </diff:delete>}</block></then></if>
<diff:delete type="whitespace">    </diff:delete>}</block></then><diff:delete type="whitespace">
   </diff:delete> <else>else <block>{
    <diff:delete type="whitespace">    </diff:delete><expr_stmt><expr><call><name><name>d</name><operator>-&gt;</operator><name>textSharedData</name><operator>-&gt;</operator><name>shapeInserted</name></name><argument_list>(<argument><expr><name>shape</name></expr></argument>, <argument><expr><name>element</name></expr></argument>, <argument><expr><name><name>d</name><operator>-&gt;</operator><name>context</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<diff:delete type="whitespace">    </diff:delete>}</block></else></if>
</diff:common>}</block></then></if>
</diff:delete></unit>

<unit filename="complex|complex">
<function><type><name>bool</name></type> <name><name>AbstractRegionCommand</name><operator>::</operator><name>isApproved</name></name><parameter_list>()</parameter_list> <specifier>const</specifier>
<block>{
    <decl_stmt><decl><type><specifier>const</specifier> <name><name>QList</name><argument_list type="template">&lt;<argument><expr><name>Element</name> <modifier>*</modifier></expr></argument>&gt;</argument_list></name></type> <name>elements</name> <init>= <expr><call><name>cells</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><specifier>const</specifier> <name>int</name></type> <name>begin</name> <init>= <expr><ternary><condition><expr><name>m_reverse</name></expr> ?</condition><then> <expr><call><name><name>elements</name><operator>.</operator><name>count</name></name><argument_list>()</argument_list></call> <operator>-</operator> <literal type="number">1</literal></expr> </then><else>: <expr><literal type="number">0</literal></expr></else></ternary></expr></init></decl>;</decl_stmt>
    <decl_stmt><decl><type><specifier>const</specifier> <name>int</name></type> <name>end</name> <init>= <expr><ternary><condition><expr><name>m_reverse</name></expr> ?</condition><then> <expr><operator>-</operator><literal type="number">1</literal></expr> </then><else>: <expr><call><name><name>elements</name><operator>.</operator><name>count</name></name><argument_list>()</argument_list></call></expr></else></ternary></expr></init></decl>;</decl_stmt><diff:insert>
    <if>if <condition>(<expr><name>m_checkLock</name> <operator>&amp;&amp;</operator> <call><name><name>m_sheet</name><operator>-&gt;</operator><name>cellStorage</name></name><argument_list>()</argument_list></call><operator>-&gt;</operator><call><name>hasLockedCells</name><argument_list>(<argument><expr><operator>*</operator><name>this</name></expr></argument>)</argument_list></call></expr>)</condition><then> <block>{
        <expr_stmt><expr><call><name><name>KPassivePopup</name><operator>::</operator><name>message</name></name><argument_list>(<argument><expr><call><name>i18n</name><argument_list>(<argument><expr><literal type="string">"Processing is not possible, because some "</literal>
                                    <literal type="string">"cells are locked as elements of a matrix."</literal></expr></argument>)</argument_list></call></expr></argument>,
                               <argument><expr><call><name><name>QApplication</name><operator>::</operator><name>activeWindow</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <return>return <expr><literal type="boolean">false</literal></expr>;</return>
    }</block></then></if></diff:insert>
<diff:insert>    <if>if <condition>(<expr><call><name><name>m_sheet</name><operator>-&gt;</operator><name>isProtected</name></name><argument_list>()</argument_list></call></expr>)</condition><then> <block>{
    <diff:common>    <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name> <init>= <expr><name>begin</name></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>!=</operator> <name>end</name></expr>;</condition> <incr><expr><ternary><condition><expr><name>m_reverse</name></expr> ?</condition><then> <expr><operator>--</operator><name>i</name></expr> </then><else>: <expr><operator>++</operator><name>i</name></expr></else></ternary></expr></incr>)</control> <block>{
        <diff:insert type="whitespace">    </diff:insert><decl_stmt><decl><type><specifier>const</specifier> <name>QRect</name></type> <name>range</name> <init>= <expr><name><name>elements</name><index>[<expr><name>i</name></expr>]</index></name><operator>-&gt;</operator><call><name>rect</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

        <diff:insert type="whitespace">    </diff:insert><for>for <control>(<init><decl><type><name>int</name></type> <name>col</name> <init>= <expr><call><name><name>range</name><operator>.</operator><name>left</name></name><argument_list>()</argument_list></call></expr></init></decl>;</init> <condition><expr><name>col</name> <operator>&lt;=</operator> <call><name><name>range</name><operator>.</operator><name>right</name></name><argument_list>()</argument_list></call></expr>;</condition> <incr><expr><operator>++</operator><name>col</name></expr></incr>)</control> <block>{
            <diff:insert type="whitespace">    </diff:insert><for>for <control>(<init><decl><type><name>int</name></type> <name>row</name> <init>= <expr><call><name><name>range</name><operator>.</operator><name>top</name></name><argument_list>()</argument_list></call></expr></init></decl>;</init> <condition><expr><name>row</name> <operator>&lt;=</operator> <call><name><name>range</name><operator>.</operator><name>bottom</name></name><argument_list>()</argument_list></call></expr>;</condition> <incr><expr><operator>++</operator><name>row</name></expr></incr>)</control> <block>{
                <diff:insert type="whitespace">    </diff:insert><function_decl><type><name>Cell</name></type> <name>cell</name><parameter_list>(<param><decl><type><name>m_sheet</name></type></decl></param>, <param><decl><type><name>col</name></type></decl></param>, <param><decl><type><name>row</name></type></decl></param>)</parameter_list>;</function_decl>
                <diff:insert type="whitespace">    </diff:insert><if>if <condition>(<expr><diff:delete><call><name><name>m_sheet</name><operator>-&gt;</operator><name>isProtected</name></name><argument_list>()</argument_list></call> <operator>&amp;&amp;</operator> </diff:delete><operator>!</operator><call><name><name>cell</name><operator>.</operator><name>style</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>notProtected</name><argument_list>()</argument_list></call></expr>)</condition><then> <block>{
                    <diff:insert type="whitespace">    </diff:insert><expr_stmt><expr><call><name><name>KPassivePopup</name><operator>::</operator><name>message</name></name><argument_list>(<argument><expr><call><name>i18n</name><argument_list>(<argument><expr><literal type="string">"Processing is not possible, "</literal>
                                                <diff:insert type="whitespace">    </diff:insert><literal type="string">"because some cells are protected."</literal></expr></argument>)</argument_list></call></expr></argument>,
                                           <diff:insert type="whitespace">    </diff:insert><argument><expr><call><name><name>QApplication</name><operator>::</operator><name>activeWindow</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                    <diff:insert type="whitespace">    </diff:insert><return>return <expr><literal type="boolean">false</literal></expr>;</return>
                <diff:insert type="whitespace">    </diff:insert>}</block></then></if>
<diff:delete>
                <comment type="line">// check for matrix locks</comment>
                <if>if <condition>(<expr><name>m_checkLock</name> <operator>&amp;&amp;</operator> <call><name><name>cell</name><operator>.</operator><name>isLocked</name></name><argument_list>()</argument_list></call></expr>)</condition><then> <block>{
                    <expr_stmt><expr><call><name><name>KPassivePopup</name><operator>::</operator><name>message</name></name><argument_list>(<argument><expr><call><name>i18n</name><argument_list>(<argument><expr><literal type="string">"Processing is not possible, because some "</literal>
                                                <literal type="string">"cells are locked as elements of a matrix."</literal></expr></argument>)</argument_list></call></expr></argument>,
                                           <argument><expr><call><name><name>QApplication</name><operator>::</operator><name>activeWindow</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                    <return>return <expr><literal type="boolean">false</literal></expr>;</return>
                }</block></then></if>
</diff:delete><diff:insert type="whitespace">    </diff:insert>            }</block></for>
        <diff:insert type="whitespace">    </diff:insert>}</block></for>
    <diff:insert type="whitespace">    </diff:insert>}</block></for>
</diff:common>    }</block></then></if>
</diff:insert>    <return>return <expr><literal type="boolean">true</literal></expr>;</return>
}</block></function>
</unit>

<unit filename="complex|complex">
<diff:delete><if>if <condition>(<expr><call><name><name>shape</name><operator>.</operator><name>has</name></name><argument_list>(<argument><expr><literal type="string">"anchor"</literal></expr></argument>)</argument_list></call></expr>)</condition><then> <block>{
    <diff:common><decl_stmt><decl><type><name>string</name></type> <name>type</name><diff:delete> <init>= <expr><call><name><name>shape</name><operator>.</operator><name>get</name></name><argument_list>(<argument><expr><literal type="string">"anchor"</literal></expr></argument>)</argument_list></call></expr></init></diff:delete></decl>;</decl_stmt>
</diff:common>    <diff:common><if>if<condition>(<expr><name>type</name> <operator>!=</operator> <literal type="string">"page"</literal></expr>)</condition><then> <block>{
    <diff:delete type="whitespace">    </diff:delete><decl_stmt><decl><type><name>Anchor</name> <modifier>*</modifier></type><name>anchor</name> <init>= <expr><operator>new</operator>
        <diff:delete type="whitespace">    </diff:delete><call><name>Anchor</name><argument_list>(<argument><expr><name>shape</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
    <diff:delete type="whitespace">    </diff:delete><expr_stmt><expr><call><name><name>anchor</name><operator>.</operator><name>loadFromShape</name></name><argument_list>(<argument><expr><name>element</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<diff:delete type="whitespace">    </diff:delete>}</block></then></if>
</diff:common>}</block></then></if>
</diff:delete></unit>

<unit filename="complex|complex">
<function><type><name>void</name></type> <name><name>KisToolSelectPolygonal</name><operator>::</operator><name>finish</name></name><parameter_list>()</parameter_list>
<block>{
    <if>if <condition>(<expr><call><name>currentImage</name><argument_list>()</argument_list></call><diff:insert> <operator>&amp;&amp;</operator> <call><name><name>m_points</name><operator>.</operator><name>count</name></name><argument_list>()</argument_list></call> <operator>&gt;</operator> <literal type="number">2</literal></diff:insert></expr>)</condition><then> <block>{
        <expr_stmt><expr><call><name><name>QApplication</name><operator>::</operator><name>setOverrideCursor</name></name><argument_list>(<argument><expr><call><name><name>KisCursor</name><operator>::</operator><name>waitCursor</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <decl_stmt><decl><type><name>KisCanvas2</name> <modifier>*</modifier></type> <name>kisCanvas</name> <init>= <expr><cast type="dynamic">dynamic_cast<argument_list type="template">&lt;<argument><expr><name>KisCanvas2</name><operator>*</operator></expr></argument>&gt;</argument_list><argument_list>(<argument><expr><name>m_canvas</name></expr></argument>)</argument_list></cast></expr></init></decl>;</decl_stmt>
        <if>if <condition>(<expr><operator>!</operator><name>kisCanvas</name></expr>)</condition><then>
            <block type="pseudo"><return>return;</return></block></then></if>

        <if>if <condition>(<expr><operator>!</operator><call><name>currentNode</name><argument_list>()</argument_list></call></expr>)</condition><then>
            <block type="pseudo"><return>return;</return></block></then></if>

        <decl_stmt><decl><type><name>KisSelectionToolHelper</name></type> <name>helper</name><argument_list>(<argument><expr><name>kisCanvas</name></expr></argument>, <argument><expr><call><name>currentNode</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>i18n</name><argument_list>(<argument><expr><literal type="string">"Polygonal Selection"</literal></expr></argument>)</argument_list></call></expr></argument>)</argument_list></decl>;</decl_stmt>

        <if>if <condition>(<expr><name>m_selectionMode</name> <operator>==</operator> <name>PIXEL_SELECTION</name></expr>)</condition><then> <block>{

            <decl_stmt><decl><type><name>KisPixelSelectionSP</name></type> <name>tmpSel</name> <init>= <expr><call><name>KisPixelSelectionSP</name><argument_list>(<argument><expr><operator>new</operator> <call><name>KisPixelSelection</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

            <function_decl><type><name>KisPainter</name></type> <name>painter</name><parameter_list>(<param><decl><type><name>tmpSel</name></type></decl></param>)</parameter_list>;</function_decl>
            <expr_stmt><expr><call><name><name>painter</name><operator>.</operator><name>setBounds</name></name><argument_list>(<argument><expr><call><name>currentImage</name><argument_list>()</argument_list></call><operator>-&gt;</operator><call><name>bounds</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>painter</name><operator>.</operator><name>setPaintColor</name></name><argument_list>(<argument><expr><call><name>KoColor</name><argument_list>(<argument><expr><name><name>Qt</name><operator>::</operator><name>black</name></name></expr></argument>, <argument><expr><call><name><name>tmpSel</name><operator>-&gt;</operator><name>colorSpace</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>painter</name><operator>.</operator><name>setFillStyle</name></name><argument_list>(<argument><expr><name><name>KisPainter</name><operator>::</operator><name>FillStyleForegroundColor</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>painter</name><operator>.</operator><name>setStrokeStyle</name></name><argument_list>(<argument><expr><name><name>KisPainter</name><operator>::</operator><name>StrokeStyleNone</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>painter</name><operator>.</operator><name>setAntiAliasPolygonFill</name></name><argument_list>(<argument><expr><call><name><name>m_optWidget</name><operator>-&gt;</operator><name>antiAliasSelection</name></name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>painter</name><operator>.</operator><name>setOpacity</name></name><argument_list>(<argument><expr><name>OPACITY_OPAQUE</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>painter</name><operator>.</operator><name>setPaintOpPreset</name></name><argument_list>(<argument><expr><call><name>currentPaintOpPreset</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><call><name>currentImage</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt> <comment type="line">// And now the painter owns the op and will destroy it.</comment>
            <expr_stmt><expr><call><name><name>painter</name><operator>.</operator><name>setCompositeOp</name></name><argument_list>(<argument><expr><call><name><name>tmpSel</name><operator>-&gt;</operator><name>colorSpace</name></name><argument_list>()</argument_list></call><operator>-&gt;</operator><call><name>compositeOp</name><argument_list>(<argument><expr><name>COMPOSITE_OVER</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name><name>painter</name><operator>.</operator><name>paintPolygon</name></name><argument_list>(<argument><expr><name>m_points</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <decl_stmt><decl><type><name>QUndoCommand</name><modifier>*</modifier></type> <name>cmd</name> <init>= <expr><call><name><name>helper</name><operator>.</operator><name>selectPixelSelection</name></name><argument_list>(<argument><expr><name>tmpSel</name></expr></argument>, <argument><expr><name>m_selectAction</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
            <expr_stmt><expr><call><name><name>m_canvas</name><operator>-&gt;</operator><name>addCommand</name></name><argument_list>(<argument><expr><name>cmd</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        }</block></then> <else>else <block>{

<diff:delete>            <if>if <condition>(<expr><call><name><name>m_points</name><operator>.</operator><name>count</name></name><argument_list>()</argument_list></call> <operator>&gt;</operator> <literal type="number">1</literal></expr>)</condition><then> <block>{
<diff:common>                <decl_stmt><decl><type><name>KoPathShape</name><modifier>*</modifier></type> <name>path</name> <init>= <expr><operator>new</operator> <call><name>KoPathShape</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
                <expr_stmt><expr><call><name><name>path</name><operator>-&gt;</operator><name>setShapeId</name></name><argument_list>(<argument><expr><name>KoPathShapeId</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

                <decl_stmt><decl><type><name>QMatrix</name></type> <name>resolutionMatrix</name></decl>;</decl_stmt>
                <expr_stmt><expr><call><name><name>resolutionMatrix</name><operator>.</operator><name>scale</name></name><argument_list>(<argument><expr><literal type="number">1</literal> <operator>/</operator> <call><name>currentImage</name><argument_list>()</argument_list></call><operator>-&gt;</operator><call><name>xRes</name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><literal type="number">1</literal> <operator>/</operator> <call><name>currentImage</name><argument_list>()</argument_list></call><operator>-&gt;</operator><call><name>yRes</name><argument_list>()</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                <expr_stmt><expr><call><name><name>path</name><operator>-&gt;</operator><name>moveTo</name></name><argument_list>(<argument><expr><call><name><name>resolutionMatrix</name><operator>.</operator><name>map</name></name><argument_list>(<argument><expr><name><name>m_points</name><index>[<expr><literal type="number">0</literal></expr>]</index></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>
                <for>for <control>(<init><decl><type><name>int</name></type> <name>i</name> <init>= <expr><literal type="number">1</literal></expr></init></decl>;</init> <condition><expr><name>i</name> <operator>&lt;</operator> <call><name><name>m_points</name><operator>.</operator><name>count</name></name><argument_list>()</argument_list></call></expr>;</condition> <incr><expr><name>i</name><operator>++</operator></expr></incr>)</control>
                    <block type="pseudo"><expr_stmt><expr><call><name><name>path</name><operator>-&gt;</operator><name>lineTo</name></name><argument_list>(<argument><expr><call><name><name>resolutionMatrix</name><operator>.</operator><name>map</name></name><argument_list>(<argument><expr><name><name>m_points</name><index>[<expr><name>i</name></expr>]</index></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt></block></for>
                <expr_stmt><expr><call><name><name>path</name><operator>-&gt;</operator><name>close</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
                <expr_stmt><expr><call><name><name>path</name><operator>-&gt;</operator><name>normalize</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>

                <expr_stmt><expr><call><name><name>helper</name><operator>.</operator><name>addSelectionShape</name></name><argument_list>(<argument><expr><name>path</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
</diff:common>            }</block></then></if>
</diff:delete>        }</block></else></if>
        <expr_stmt><expr><call><name><name>QApplication</name><operator>::</operator><name>restoreOverrideCursor</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
    }</block></then></if>

    <expr_stmt><expr><call><name>deactivate</name><argument_list>()</argument_list></call></expr>;</expr_stmt>
}</block></function>
</unit>

<unit filename="complex|complex">
<function><type><name>bool</name></type> <name><name>Sheet</name><operator>::</operator><name>testListChoose</name></name><parameter_list>(<param><decl><type><name>Selection</name><modifier>*</modifier></type> <name>selection</name></decl></param>)</parameter_list>
<block>{
  <diff:delete type="whitespace"> </diff:delete><decl_stmt><decl><type><specifier>const</specifier> <name>QPoint</name></type> <name>marker</name><argument_list>( <argument><expr><call><name><name>selection</name><operator>-&gt;</operator><name>marker</name></name><argument_list>()</argument_list></call></expr></argument> )</argument_list></decl>;</decl_stmt>
  <diff:delete type="whitespace"> </diff:delete><decl_stmt><decl><type><specifier>const</specifier> <name>QString</name></type> <name>text</name> <init>= <expr><call><name>Cell</name><argument_list>( <argument><expr><name>this</name></expr></argument>, <argument><expr><name>marker</name></expr></argument> )</argument_list></call><operator>.</operator><call><name>userInput</name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>

<diff:insert>  <decl_stmt><decl><type><name><name>Region</name><operator>::</operator><name>ConstIterator</name></name></type> <name>end</name><argument_list>( <argument><expr><call><name><name>selection</name><operator>-&gt;</operator><name>constEnd</name></name><argument_list>()</argument_list></call></expr></argument> )</argument_list></decl>;</decl_stmt>
</diff:insert><diff:delete type="whitespace"> </diff:delete>    <decl_stmt><decl><type><specifier>const</specifier> <name>QRect</name></type> <name>range</name> <init>= <expr><call><name><operator>(</operator><operator>*</operator><name>it</name><operator>)</operator><operator>-&gt;</operator><name>rect</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt><diff:insert>
 
    <decl_stmt><decl><type><name>int</name></type> <name>bottom</name> <init>= <expr><call><name><name>range</name><operator>.</operator><name>bottom</name></name><argument_list>()</argument_list></call></expr></init></decl>;</decl_stmt>
    <if>if <condition>(<expr><name>bottom</name> <operator>&gt;</operator> <call><name><name>d</name><operator>-&gt;</operator><name>cellStorage</name><operator>-&gt;</operator><name>rows</name></name><argument_list>()</argument_list></call></expr>)</condition><then> <block type="pseudo"><expr_stmt><expr><name>bottom</name> <operator>=</operator> <call><name><name>d</name><operator>-&gt;</operator><name>cellStorage</name><operator>-&gt;</operator><name>rows</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt></block></then></if></diff:insert>
<diff:delete>     <for>for <control>( <init><decl><type><name>int</name></type> <name>col</name> <init>= <expr><call><name><name>range</name><operator>.</operator><name>left</name></name><argument_list>()</argument_list></call></expr></init></decl>;</init> <condition><expr><name>col</name> <operator>&lt;=</operator> <call><name><name>range</name><operator>.</operator><name>right</name></name><argument_list>()</argument_list></call></expr>;</condition> <incr><expr><operator>++</operator><name>col</name></expr></incr> )</control> <block>{
   <diff:common>    <for>for <control>(<diff:delete type="whitespace"> </diff:delete><init><decl><type><name>int</name></type> <name>row</name> <init>= <expr><call><name><name>range</name><operator>.</operator><name>top</name></name><argument_list>()</argument_list></call></expr></init></decl>;</init> <condition><expr><name>row</name> <operator>&lt;=</operator> <diff:delete type="change"><call><name><name>range</name><operator>.</operator><name>bottom</name></name><argument_list>()</argument_list></call></diff:delete><diff:insert type="change"><name>bottom</name></diff:insert></expr>;</condition> <incr><expr><operator>++</operator><name>row</name></expr></incr><diff:delete type="whitespace"> </diff:delete>)</control>
    <diff:delete type="whitespace">   </diff:delete><block>{<diff:delete type="change">
         <function_decl><type><specifier>const</specifier> <name>Cell</name></type> <name>cell</name><parameter_list>( <param><decl><type><name>this</name></type></decl></param>, <param><decl><type><name>col</name></type></decl></param>, <param><decl><type><name>row</name></type></decl></param> )</parameter_list>;</function_decl></diff:delete><diff:insert type="change">
      <decl_stmt><decl><type><name>int</name></type> <name>col</name> <init>= <expr><call><name><name>range</name><operator>.</operator><name>left</name></name><argument_list>()</argument_list></call> <operator>-</operator> <literal type="number">1</literal></expr></init></decl>;</decl_stmt></diff:insert>
<diff:insert>      <while>while <condition>(<expr><literal type="number">1</literal></expr>)</condition> <block>{
        <decl_stmt><decl><type><specifier>const</specifier> <name>Cell</name></type> <name>cell</name> <init>= <expr><call><name><name>d</name><operator>-&gt;</operator><name>cellStorage</name><operator>-&gt;</operator><name>nextInRow</name></name> <argument_list>(<argument><expr><name>col</name></expr></argument>, <argument><expr><name>row</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>
        <if>if <condition>(<expr><call><name><name>cell</name><operator>.</operator><name>isNull</name></name><argument_list>()</argument_list></call></expr>)</condition><then> <block type="pseudo"><break>break;</break></block></then></if>
        <expr_stmt><expr><name>col</name> <operator>=</operator> <call><name><name>cell</name><operator>.</operator><name>column</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt>
        <if>if <condition>(<expr><call><name><name>cell</name><operator>.</operator><name>isDefault</name></name><argument_list>()</argument_list></call> <operator>||</operator> <operator>(</operator><name>col</name> <operator>==</operator> <literal type="number">0</literal><operator>)</operator> <operator>||</operator> <operator>(</operator><name>col</name> <operator>&gt;</operator> <call><name><name>range</name><operator>.</operator><name>right</name></name><argument_list>()</argument_list></call><operator>)</operator></expr>)</condition><then> <block type="pseudo"><break>break;</break></block></then></if>

        <diff:common><if>if <condition>( <expr><operator>!</operator><call><name><name>cell</name><operator>.</operator><name>isPartOfMerged</name></name><argument_list>()</argument_list></call> <operator>&amp;&amp;</operator> <operator>!</operator><operator>(</operator> <name>col</name> <operator>==</operator> <call><name><name>marker</name><operator>.</operator><name>x</name></name><argument_list>()</argument_list></call> <operator>&amp;&amp;</operator> <name>row</name> <operator>==</operator> <call><name><name>marker</name><operator>.</operator><name>y</name></name><argument_list>()</argument_list></call> <operator>)</operator></expr> )</condition><then>
        <diff:delete type="whitespace"> </diff:delete><block>{
          <diff:delete type="whitespace"> </diff:delete><if>if <condition>( <expr><operator>!</operator><call><name><name>cell</name><operator>.</operator><name>isFormula</name></name><argument_list>()</argument_list></call> <operator>&amp;&amp;</operator> <operator>!</operator><call><name><name>cell</name><operator>.</operator><name>value</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>isNumber</name><argument_list>()</argument_list></call> <operator>&amp;&amp;</operator>
               <diff:delete type="whitespace"> </diff:delete><operator>!</operator><call><name><name>cell</name><operator>.</operator><name>value</name></name><argument_list>()</argument_list></call><operator>.</operator><call><name>asString</name><argument_list>()</argument_list></call><operator>.</operator><call><name>isEmpty</name><argument_list>()</argument_list></call> <operator>&amp;&amp;</operator>
               <diff:delete type="whitespace"> </diff:delete><operator>!</operator><call><name><name>cell</name><operator>.</operator><name>isTime</name></name><argument_list>()</argument_list></call> <operator>&amp;&amp;</operator> <operator>!</operator><call><name><name>cell</name><operator>.</operator><name>isDate</name></name><argument_list>()</argument_list></call></expr> )</condition><then>
          <diff:delete type="whitespace"> </diff:delete><block>{
            <diff:delete type="whitespace"> </diff:delete><if>if <condition>( <expr><call><name><name>cell</name><operator>.</operator><name>userInput</name></name><argument_list>()</argument_list></call> <operator>!=</operator> <name>text</name></expr> )</condition><then>
              <diff:delete type="whitespace"> </diff:delete><block type="pseudo"><return>return <expr><literal type="boolean">true</literal></expr>;</return></block></then></if>
          <diff:delete type="whitespace"> </diff:delete>}</block></then></if>
        <diff:delete type="whitespace"> </diff:delete>}</block></then></if>
</diff:common>      }</block></while>
</diff:insert><diff:delete type="whitespace">   </diff:delete>    }</block></for>
</diff:common>     }</block></for>
 </diff:delete>  <return>return <expr><literal type="boolean">false</literal></expr>;</return>
}</block></function>
</unit>

<unit filename="complex|complex">
   <diff:delete type="whitespace"> </diff:delete><if>if <condition>(<expr><call><name>read_icc_profile</name><argument_list>(<argument><expr><operator>&amp;</operator><name>cinfo</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>profile_data</name></expr></argument>, <argument><expr><operator>&amp;</operator><name>profile_len</name></expr></argument>)</argument_list></call></expr>)</condition><then> <block>{
        <expr_stmt><expr><call><name><name>profile_rawdata</name><operator>.</operator><name>resize</name></name><argument_list>(<argument><expr><name>profile_len</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <expr_stmt><expr><call><name>memcpy</name><argument_list>(<argument><expr><call><name><name>profile_rawdata</name><operator>.</operator><name>data</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>profile_data</name></expr></argument>, <argument><expr><name>profile_len</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
        <decl_stmt><decl><type><name>cmsHPROFILE</name></type> <name>hProfile</name> <init>= <expr><call><name>cmsOpenProfileFromMem</name><argument_list>(<argument><expr><name>profile_data</name></expr></argument>, <argument><expr><operator>(</operator><name>DWORD</name><operator>)</operator><name>profile_len</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

        <if>if <condition>(<expr><name>hProfile</name> <operator>!=</operator> <operator>(</operator><name>cmsHPROFILE</name><operator>)</operator> <name>NULL</name></expr>)</condition><then> <block>{
            <expr_stmt><expr><name>profile</name> <operator>=</operator> <call><name><name>KoColorSpaceRegistry</name><operator>::</operator><name>instance</name></name><argument_list>()</argument_list></call><operator>-&gt;</operator><call><name>createColorProfile</name><argument_list>(<argument><expr><name>modelId</name></expr></argument>, <argument><expr><call><name><name>Integer8BitsColorDepthID</name><operator>.</operator><name>id</name></name><argument_list>()</argument_list></call></expr></argument>, <argument><expr><name>profile_rawdata</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
            <expr_stmt><expr><call><name>Q_CHECK_PTR</name><argument_list>(<argument><expr><name>profile</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>
<diff:delete type="change"><comment type="line">//             dbgFile &lt;&lt;"profile name:" &lt;&lt; profile-&gt;productName() &lt;&lt;" profile description:" &lt;&lt; profile-&gt;productDescription() &lt;&lt;" information sur le produit:" &lt;&lt; profile-&gt;productInfo();</comment></diff:delete><diff:insert type="change">            <expr_stmt><expr><name>dbgFile</name> <operator>&lt;&lt;</operator><literal type="string">"profile name:"</literal> <operator>&lt;&lt;</operator> <call><name><name>profile</name><operator>-&gt;</operator><name>name</name></name><argument_list>()</argument_list></call> <operator>&lt;&lt;</operator><literal type="string">" product information:"</literal> <operator>&lt;&lt;</operator> <call><name><name>profile</name><operator>-&gt;</operator><name>info</name></name><argument_list>()</argument_list></call></expr>;</expr_stmt></diff:insert>
            <if>if <condition>(<expr><operator>!</operator><call><name><name>profile</name><operator>-&gt;</operator><name>isSuitableForOutput</name></name><argument_list>()</argument_list></call></expr>)</condition><then> <block>{
                <expr_stmt><expr><name>dbgFile</name> <operator>&lt;&lt;</operator> <literal type="string">"the profile is not suitable for output and therefore cannot be used in krita, we need to convert the image to a standard profile"</literal></expr>;</expr_stmt> <comment type="line">// TODO: in ko2 popup a selection menu to inform the user</comment>
            }</block></then></if>
        }</block></then></if>
    }</block></then></if>
</unit>

</unit>
