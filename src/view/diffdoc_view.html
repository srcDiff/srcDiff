<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
var files = <?php $out = array();
foreach (glob('*.srcdiff.html') as $filename) {
    $p = pathinfo($filename);
    $out[] = $p['filename'];
}
echo json_encode($out); ?>;
var position = files.length - 1;
var is_signature = true

function load_all() {
    $("#source").load(files[position])/*, function(){
             $("[content=\"body\"]").click(function() {
               current_element = $(this).attr("id");
               alert(current_element)
               $("#source").load(files[position] + " [id=\"" + current_element + "\"]")
             });
        });*/
}

function load_full() {
 $("#source").load(files[position] + " [id=\"" + current_element + "\"][content=\"full\"]", 
    function() {
      $("#source").children("[content=\"full\"]").wrap("<pre></pre>")
      $("[id=\"" + current_element + "\"][content=\"signature\"]").children("[content=\"pre\"]").show();
    });
}

function load_signatures() {
    $("#source").load(files[position] + " [content=\"signature\"]", function(){
             $("#source").find("[content=\"pre\"]").show();
             $("[content=\"signature\"]").wrap("<pre></pre>");
             $("[content=\"signature\"]").click(function() {
               current_element = $(this).attr("id");
               load_full();
             });
        });
}

function load_document() {
  if(current_element != "") {
    load_full()
  } else if(is_signature) {
    load_signatures();
  } else {
    load_all();
  }
}

function next_version() {
  position += 1;
  if(position == files.length) {
    position = 0;
  }
  load_document()
}

function previous_version() {
  if(position == 0) {
    position = files.length;
  }
  position -= 1;
  load_document()
}

function roll_up() {
  /* maybe make a stack to support true drill down/roll up */
  current_element = "";
  load_document();
}

function set_is_signature(value) {
  old_is_signature = is_signature
  is_signature = value;
  if(old_is_signature != is_signature) {
    load_document()
  }
}

var current_element = ""
$(document).ready(function() {
  $("#signature").attr('checked', true);
  load_signatures();
  $("#next").click(next_version);
  $("#prev").click(previous_version);
  $("#rollup").click(roll_up);
});

</script>
</head>
<body>

<button id="prev">previous</button>
<button id="next">next</button>
<button id="rollup">roll-up</button>
<span><input id="signature"  type="radio" name="detail" value="signatures" onclick=set_is_signature(true)> Summary</span>
<span><input id="full"     type="radio" name="detail" value="full" onclick=set_is_signature(false)> Full</span>

<div id="source"></div>

</body>
</html>
